# AMOUS 웹사이트 작업 내역
**작업일시:** 2025.02.09 08:20

---

## 완료된 작업

### 1. 메인페이지 이미지 적용 문제 해결 ✅
- **문제:** Admin에서 이미지를 저장했지만 API 응답에 포함되지 않음
- **원인:** 로컬 개발 서버 캐시 문제, `about_images`가 빈 배열
- **해결:**
  - `about_images`를 `hero_images`와 동일한 이미지로 업데이트
  - Vercel 재배포 트리거 (Git push)
  - DB 데이터 확인: `hero_images`, `about_images` 모두 정상 저장됨

### 2. 강사 데이터베이스 스키마 수정 ✅
- **문제:** Instructors 테이블 스키마가 코드와 불일치
  - 실제 DB: `id` (uuid), `instructor_code` (text, NOT NULL)
  - 코드 기대: `id` (auto-increment), `instructor_code` (선택)
- **해결:**
  - Supabase SQL Editor에서 누락된 컬럼 추가:
    - `name`, `role`, `description`, `specialties`, `image_url`, `sort_order`, `updated_at`
  - `instructors_id_fkey` 외래키 제약 제거 (profiles 테이블이 비어있어 충돌)
  - RLS 정책 재설정 (모든 작업 허용)
  - 샘플 강사 데이터 1개 추가 성공

### 3. 강사 등록 API 수정 ✅
- **파일:** `src/app/api/instructors/route.ts`
- **문제:** POST 요청 시 `id`와 `instructor_code` 누락으로 NOT NULL 제약 위반
- **해결:**
  ```typescript
  // UUID와 instructor_code 자동 생성
  const instructorData = {
    ...insertData,
    id: crypto.randomUUID(), // UUID 자동 생성
    instructor_code: insertData.instructor_code || `INST${Date.now()}`, // 타임스탬프 기반 자동 생성
  };
  ```
- **결과:** Admin 페이지에서 강사 추가 시 필수 필드가 자동으로 채워짐

### 4. 스키마 캐시 리프레시 ✅
- `NOTIFY pgrst, 'reload schema';` 실행으로 PostgREST 캐시 업데이트
- API와 DB 간 스키마 동기화 완료

---

## 미완료 작업

### 1. 강사 추가/편집 기능 전체 테스트
- Admin 페이지에서 강사 추가는 가능
- 다음 테스트 필요:
  - [ ] 여러 강사 추가 테스트
  - [ ] 강사 정보 수정 테스트
  - [ ] 강사 삭제 테스트
  - [ ] 강사 프로필 이미지 업로드 테스트
  - [ ] 서비스 페이지에서 강사 정보 표시 확인

### 2. 에이머스 스튜디오(AMOUS Studio) 웹사이트
- 건축 CG/3D 시각화 전문 별도 웹사이트
- 아직 미착수

---

## 수정된 주요 파일

| 파일 | 변경 내용 |
|------|-----------|
| `src/app/api/instructors/route.ts` | POST 메서드에 UUID 및 instructor_code 자동 생성 로직 추가 |
| Supabase `instructors` 테이블 | 컬럼 추가 (name, role, description 등), 외래키 제약 제거, RLS 정책 재설정 |
| `site_content` 테이블 | about_images 데이터 업데이트 |

---

## 데이터베이스 변경사항

### Instructors 테이블 최종 스키마
```sql
- id: uuid (PRIMARY KEY, NOT NULL)
- instructor_code: text (NOT NULL)
- assigned_schools: text[] (ARRAY)
- created_at: timestamptz
- service_ids: int[] (ARRAY)
- certifications: text[] (ARRAY)
- career: text
- lecture_history: text
- name: text (신규 추가)
- role: text (신규 추가)
- description: text (신규 추가)
- specialties: text[] (신규 추가)
- image_url: text (신규 추가)
- sort_order: int (신규 추가)
- updated_at: timestamptz (신규 추가)
```

### RLS 정책
```sql
- instructors_select: SELECT USING (true)
- instructors_insert: INSERT WITH CHECK (true)
- instructors_update: UPDATE USING (true)
- instructors_delete: DELETE USING (true)
```

---

## 검증 완료 항목

✅ DB에서 강사 데이터 조회 가능 (1개)
✅ Admin 로그인 정상 작동
✅ API 코드 수정으로 강사 추가 시 필수 필드 자동 생성
✅ 스키마 캐시 리프레시 완료

---

## 다음 작업 제안

1. **강사 관리 기능 테스트**
   - Admin에서 강사 CRUD 전체 테스트
   - 서비스 페이지에서 강사 표시 확인

2. **프로덕션 배포 확인**
   - Vercel 배포 후 메인페이지 이미지 롤링 확인
   - API 응답에 hero_images, about_images 포함 확인

3. **에이머스 스튜디오 웹사이트 구축**
   - 요구사항 정의
   - 디자인 및 개발

---

## 기술 스택
- **Frontend:** Next.js 14 (App Router), Tailwind CSS, Framer Motion
- **Backend:** Supabase (PostgreSQL + Storage + Auth)
- **배포:** Vercel (자동 배포)
- **저장소:** GitHub (infoamous-source/amous-website)

---

## 참고 파일
- `setup-instructors-table.sql` - Supabase 테이블 설정 SQL
- `check-db.js` - DB 데이터 확인 스크립트
- `fix-rls.sql` - RLS 정책 재설정 SQL
- `README_INSTRUCTOR_SETUP.md` - 강사 설정 가이드
