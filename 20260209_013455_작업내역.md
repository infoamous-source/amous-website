# AMOUS 웹사이트 작업 내역
**작업일시:** 2025.02.08 ~ 2025.02.09 01:35

---

## 완료된 작업

### 1. 강의 분야 통합 및 보유 자격 추가
- `specialties` + `teaching_fields` → **강의 분야** 하나로 통합
- 노출 형태: 태그(pill) 형식 (navy 배경)
- **보유 자격(certifications)** 필드 신규 추가 (amber 배경 태그)
- Admin/Frontend 모두 적용

### 2. 쉼표 입력 문제 해결
- **문제:** 한글 IME에서 쉼표(,) 입력 시 실시간 split으로 인해 입력 불가
- **해결:** raw text 방식으로 변경, 저장 시에만 쉼표로 분리
- 입력 중 태그 미리보기 표시 추가

### 3. 메인페이지 이미지 롤링 (다중 이미지)
- Hero 대표 이미지: 최대 5장, **4초 간격 자동 롤링** (Framer Motion AnimatePresence)
- About 대표 활동 이미지: 최대 5장, **5초 간격 자동 롤링**
- 각 섹션 하단 dot 인디케이터 (클릭 가능)
- `hero_image` → `hero_images`, `about_image` → `about_images` (JSON 배열)

### 4. Admin 이미지 갤러리 개별 저장 버튼
- Hero / About 각각 독립 **저장 버튼** 추가
- 미저장 변경사항 있으면 amber 테두리 + 경고 표시
- 이미지 순서 변경(◀▶), 삭제(✕) 기능

### 5. 블로그 카테고리 숨김
- 네비게이션에서 블로그 링크 **비노출** (constants.ts에서 주석 처리)
- 데이터는 유지, 노출만 OFF

### 6. Vercel API 캐싱 문제 해결
- **문제:** GET 캐시로 인해 PUT/POST가 405 반환
- **해결:** 모든 API route에 `export const dynamic = "force-dynamic"` 추가

### 7. RLS(Row Level Security) 정책 수정
- **문제:** Supabase RLS가 새로 삽입된 행의 SELECT를 차단
- DB에 11행 존재하나 API에서 9행만 반환
- **해결:** site_content, instructors 테이블에 permissive RLS 정책 적용
  ```sql
  CREATE POLICY "xxx_select" ON table FOR SELECT USING (true);
  CREATE POLICY "xxx_insert" ON table FOR INSERT WITH CHECK (true);
  CREATE POLICY "xxx_update" ON table FOR UPDATE USING (true);
  ```

### 8. service_id → service_ids 전환
- **문제:** instructors 테이블에 `service_id` 컬럼 없음 (에러 발생)
- **해결:** 모든 코드에서 `service_id` 참조 제거, `service_ids INT[]` 배열만 사용
- API GET: 배열 기반 필터링, POST/PUT: service_id 자동 제거
- supabase.ts `getInstructorsByService` → `.contains()` 쿼리 사용

### 9. 강사 추가 오류 수정
- **문제:** 새 강사 POST 시 `id: 0`이 전송되어 auto increment 충돌
- **해결:** POST에서 `id` 필드 자동 제거
- API 에러 응답에 상세 메시지(hint, details) 포함

### 10. DB 스키마 확장 (SQL 실행 완료)
- `instructors` 테이블에 컬럼 추가:
  - `service_ids INT[]`
  - `certifications TEXT[]`
  - `career TEXT`
  - `lecture_history TEXT`

### 11. site-content API upsert → select+update/insert 패턴
- **문제:** upsert가 RLS 환경에서 silent fail
- **해결:** 명시적 존재 확인 후 update 또는 insert 수행

---

## 미완료 작업 (다음 세션에서 진행)

### 1. 메인페이지 이미지 적용 안됨
- Admin에서 이미지 저장은 성공하나 **웹사이트에 반영되지 않음**
- RLS 정책은 수정 완료 → Admin에서 **다시 저장** 후 확인 필요
- site_content 테이블의 `hero_images`, `about_images` 키에 데이터가 있는지 확인
- 안 되면 site-content API의 GET에서 hero_images/about_images 반환 여부 디버깅

### 2. 강사 데이터 복구/재입력
- 이전에 있던 강사 데이터가 사라진 상태 (테이블이 빈 배열 반환)
- RLS + service_id 문제가 해결되었으므로 Admin에서 **강사 재등록** 필요
- 이전 데이터가 DB에 남아있는지 Supabase 대시보드에서 확인

### 3. 강사 추가/편집 기능 테스트
- service_id 제거, id=0 제거 등 수정 후 실제 동작 테스트 필요
- 강의 분야 쉼표 입력, 보유 자격 입력 테스트
- 소속 서비스 복수 선택 테스트

### 4. 에이머스 스튜디오(AMOUS Studio) 웹사이트
- 건축 CG/3D 시각화 전문 별도 웹사이트
- 이전 세션에서 요청됨, 아직 미착수

---

## 수정된 주요 파일

| 파일 | 변경 내용 |
|------|-----------|
| `src/app/admin/instructors/page.tsx` | 강의분야 통합, 보유자격 추가, 쉼표 입력 수정, service_id 제거 |
| `src/app/admin/site-content/page.tsx` | 다중 이미지 갤러리, 개별 저장 버튼 |
| `src/app/api/instructors/route.ts` | service_id 제거, id=0 제거, 에러 상세화 |
| `src/app/api/site-content/route.ts` | force-dynamic, upsert→select+update/insert |
| `src/app/services/[slug]/page.tsx` | service_ids 기반 필터링, certifications 표시 |
| `src/components/sections/HeroSection.tsx` | 다중 이미지 롤링 (4초) |
| `src/components/sections/AboutSection.tsx` | 다중 이미지 롤링 (5초) |
| `src/lib/supabase.ts` | Instructor 인터페이스 업데이트 |
| `src/lib/constants.ts` | 블로그 네비 숨김 |
| 모든 API routes | `export const dynamic = "force-dynamic"` 추가 |

---

## 기술 스택
- **Frontend:** Next.js 14 (App Router), Tailwind CSS, Framer Motion
- **Backend:** Supabase (PostgreSQL + Storage + Auth)
- **배포:** Vercel (자동 배포)
- **저장소:** GitHub (infoamous-source/amous-website)
